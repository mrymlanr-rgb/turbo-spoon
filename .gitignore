import streamlit as st
import json
import os
from utils.progress_tracker import ProgressTracker

# Configure page
st.set_page_config(
    page_title="Ù…Ù†ØµØ© ØªØ¹Ù„Ù… Ø¨Ø§ÙŠØ«ÙˆÙ†",
    page_icon="ğŸ",
    layout="wide",
    initial_sidebar_state="expanded"
)

# Initialize progress tracker
if 'progress_tracker' not in st.session_state:
    st.session_state.progress_tracker = ProgressTracker()

# Main page content
st.title("ğŸ Ù…Ù†ØµØ© ØªØ¹Ù„Ù… Ø¨Ø§ÙŠØ«ÙˆÙ† Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†")
st.markdown("### Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø±Ø­Ù„Ø© ØªØ¹Ù„Ù… Ù„ØºØ© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø¨Ø§ÙŠØ«ÙˆÙ†!")

# Welcome section
col1, col2 = st.columns([2, 1])

with col1:
    st.markdown("""
    ## Ù…Ø§Ø°Ø§ Ø³ØªØªØ¹Ù„Ù…ØŸ
    
    ğŸ“š **Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª**: Ø§Ù„Ù…ØªØºÙŠØ±Ø§ØªØŒ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    
    ğŸ”„ **Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆØ§Ù„Ø´Ø±ÙˆØ·**: Ø§Ù„Ø­Ù„Ù‚Ø§Øª ÙˆØ§Ù„Ø¬Ù…Ù„ Ø§Ù„Ø´Ø±Ø·ÙŠØ©
    
    ğŸ”§ **Ø§Ù„Ø¯ÙˆØ§Ù„**: ÙƒÙŠÙÙŠØ© ÙƒØªØ§Ø¨Ø© ÙˆØ¥Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯ÙˆØ§Ù„
    
    ğŸ“Š **Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**: Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…ØŒ Ø§Ù„Ù‚ÙˆØ§Ù…ÙŠØ³ØŒ ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
    
    ğŸ¯ **Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©**: ØªØ·Ø¨ÙŠÙ‚ Ù…Ø§ ØªØ¹Ù„Ù…ØªÙ‡ ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­Ù‚ÙŠÙ‚ÙŠØ©
    """)

with col2:
    st.markdown("### ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ")
    progress = st.session_state.progress_tracker.get_overall_progress()
    st.metric("Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²", f"{progress:.1f}%")
    
    completed_lessons = st.session_state.progress_tracker.get_completed_lessons_count()
    st.metric("Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©", completed_lessons)
    
    st.markdown("---")
    st.markdown("### ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†")
    if st.button("Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±ÙˆØ³", type="primary"):
        st.switch_page("pages/1_Ø§Ù„Ø¯Ø±ÙˆØ³.py")

# Features section
st.markdown("---")
st.markdown("## âœ¨ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ù†ØµØ©")

col1, col2, col3 = st.columns(3)

with col1:
    st.markdown("""
    ### ğŸ’» Ù…Ø­Ø±Ø± ÙƒÙˆØ¯ ØªÙØ§Ø¹Ù„ÙŠ
    Ø§ÙƒØªØ¨ ÙˆØ¬Ø±Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¹ ØªÙ†ÙÙŠØ° ÙÙˆØ±ÙŠ Ù„Ù„Ù†ØªØ§Ø¦Ø¬
    """)

with col2:
    st.markdown("""
    ### ğŸ“– Ø¯Ø±ÙˆØ³ ØªØ¯Ø±ÙŠØ¬ÙŠØ©
    ØªØ¹Ù„Ù… Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù
    """)

with col3:
    st.markdown("""
    ### ğŸ¯ ØªÙ…Ø§Ø±ÙŠÙ† Ø¹Ù…Ù„ÙŠØ©
    Ø·Ø¨Ù‚ Ù…Ø§ ØªØ¹Ù„Ù…ØªÙ‡ Ù…Ù† Ø®Ù„Ø§Ù„ ØªÙ…Ø§Ø±ÙŠÙ† Ù…ØªÙ†ÙˆØ¹Ø© ÙˆÙ…ÙÙŠØ¯Ø©
    """)

# Quick start section
st.markdown("---")
st.markdown("## ğŸƒâ€â™‚ï¸ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹")

quick_start_col1, quick_start_col2 = st.columns(2)

with quick_start_col1:
    st.markdown("""
    ### Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯:
    1. Ø§Ø¨Ø¯Ø£ Ø¨ØµÙØ­Ø© **Ø§Ù„Ø¯Ø±ÙˆØ³** Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª
    2. Ø¬Ø±Ø¨ **Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒÙˆØ¯** Ù„ØªØ¬Ø±Ø¨Ø© Ù…Ø§ ØªØ¹Ù„Ù…ØªÙ‡
    3. Ø­Ù„ **Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†** Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ø±ÙØ©
    4. ØªØ§Ø¨Ø¹ **Ø§Ù„ØªÙ‚Ø¯Ù…** Ù„Ù…Ø¹Ø±ÙØ© Ù…Ø³ØªÙˆØ§Ùƒ
    """)

with quick_start_col2:
    st.markdown("""
    ### Ù†ØµØ§Ø¦Ø­ Ù…Ù‡Ù…Ø©:
    - Ø®Ø° ÙˆÙ‚ØªÙƒ ÙÙŠ ÙÙ‡Ù… ÙƒÙ„ Ù…ÙÙ‡ÙˆÙ…
    - Ø¬Ø±Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ù…Ø¹Ø·Ø§Ø©
    - Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    - ØªÙ…Ø±Ù† ÙƒØ«ÙŠØ±Ø§Ù‹ Ù„ØªØ±Ø³ÙŠØ® Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
    """)

# Footer
st.markdown("---")
st.markdown("""
<div style='text-align: center; color: #666;'>
    <p>ØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†ØµØ© Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§ÙŠØ«ÙˆÙ† Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªÙØ§Ø¹Ù„ÙŠØ© ÙˆÙ…Ù…ØªØ¹Ø©</p>
    <p>ğŸ Happy Coding! ğŸ</p>
</div>
""", unsafe_allow_html=True)
import streamlit as st
import json
from streamlit_ace import st_ace
from utils.code_executor import CodeExecutor
from utils.progress_tracker import ProgressTracker

# Page configuration
st.set_page_config(page_title="Ø§Ù„Ø¯Ø±ÙˆØ³", page_icon="ğŸ“š", layout="wide")

# Initialize utilities
@st.cache_data
def load_lessons():
    with open('lessons/lessons_data.json', 'r', encoding='utf-8') as f:
        return json.load(f)

if 'code_executor' not in st.session_state:
    st.session_state.code_executor = CodeExecutor()

if 'progress_tracker' not in st.session_state:
    st.session_state.progress_tracker = ProgressTracker()

# Load lessons data
lessons_data = load_lessons()
lessons = lessons_data['lessons']

st.title("ğŸ“š Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©")

# Sidebar for lesson navigation
st.sidebar.title("Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³")
lesson_titles = [f"{lesson['id']}. {lesson['title']}" for lesson in lessons]
selected_lesson_index = st.sidebar.selectbox(
    "Ø§Ø®ØªØ± Ø¯Ø±Ø³:",
    range(len(lesson_titles)),
    format_func=lambda x: lesson_titles[x]
)

# Get selected lesson
selected_lesson = lessons[selected_lesson_index]
lesson_id = selected_lesson['id']

# Progress indicator
progress = st.session_state.progress_tracker.get_overall_progress()
st.sidebar.metric("Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ", f"{progress:.1f}%")

# Lesson completion status
is_completed = st.session_state.progress_tracker.is_lesson_completed(lesson_id)
if is_completed:
    st.sidebar.success("âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³")
else:
    st.sidebar.info("â³ Ù„Ù… ÙŠÙƒØªÙ…Ù„ Ø¨Ø¹Ø¯")

# Main content
col1, col2 = st.columns([2, 1])

with col1:
    # Lesson header
    st.header(f"Ø¯Ø±Ø³ {selected_lesson['id']}: {selected_lesson['title']}")
    st.badge(selected_lesson['level'], type="secondary")
    st.write(selected_lesson['description'])
    
    # Theory section
    st.subheader("ğŸ“– Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ù†Ø¸Ø±ÙŠ")
    st.write(selected_lesson['content']['theory'])
    
    # Code example section
    st.subheader("ğŸ’» Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÙŠ")
    st.code(selected_lesson['content']['example'], language='python')
    
    # Explanation
    st.subheader("ğŸ“ Ø´Ø±Ø­ Ø§Ù„ÙƒÙˆØ¯")
    st.write(selected_lesson['content']['explanation'])
    
    # Interactive code editor
    st.subheader("ğŸ§ª Ø¬Ø±Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†ÙØ³Ùƒ")
    st.write("ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡ ÙˆØªØ¬Ø±Ø¨ØªÙ‡:")
    
    # Code editor
    user_code = st_ace(
        value=selected_lesson['content']['example'],
        language='python',
        theme='github',
        font_size=14,
        tab_size=4,
        wrap=True,
        height=200,
        key=f"lesson_{lesson_id}_editor"
    )
    
    # Execute button
    col_exec, col_clear = st.columns([1, 1])
    
    with col_exec:
        if st.button("â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯", type="primary"):
            if user_code.strip():
                # Validate and execute code
                is_valid, validation_msg = st.session_state.code_executor.validate_code(user_code)
                
                if is_valid:
                    with st.spinner("Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯..."):
                        result = st.session_state.code_executor.execute_code(user_code)
                        st.session_state.progress_tracker.increment_code_runs()
                    
                    if result['success']:
                        st.success("ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!")
                        if result['output']:
                            st.subheader("ğŸ“¤ Ø§Ù„Ù†ØªÙŠØ¬Ø©:")
                            st.code(result['output'], language='text')
                        st.info(f"ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°: {result['execution_time']:.3f} Ø«Ø§Ù†ÙŠØ©")
                    else:
                        st.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯:")
                        st.code(result['error'], language='text')
                else:
                    st.error(validation_msg)
            else:
                st.warning("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø¨Ø¹Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹")
    
    with col_clear:
        if st.button("ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯"):
            st.rerun()

with col2:
    # Quiz section
    st.subheader("ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹")
    quiz = selected_lesson['quiz']
    
    st.write(quiz['question'])
    
    # Quiz options
    user_answer = st.radio(
        "Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:",
        range(len(quiz['options'])),
        format_func=lambda x: quiz['options'][x],
        key=f"quiz_{lesson_id}"
    )
    
    if st.button("ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©", key=f"check_quiz_{lesson_id}"):
        if user_answer == quiz['correct']:
            st.success("ğŸ‰ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª!")
            st.session_state.progress_tracker.save_quiz_score(lesson_id, 1)
            if not is_completed:
                st.session_state.progress_tracker.mark_lesson_completed(lesson_id)
                st.success("ğŸ† ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³!")
                st.balloons()
                st.rerun()
        else:
            st.error("âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!")
            correct_answer = quiz['options'][quiz['correct']]
            st.info(f"Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: {correct_answer}")
    
    # Previous quiz score
    quiz_score = st.session_state.progress_tracker.get_quiz_score(lesson_id)
    if quiz_score > 0:
        st.success("âœ… Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ù† Ù‚Ø¨Ù„")
    
    # Lesson navigation
    st.subheader("ğŸ§­ Ø§Ù„ØªÙ†Ù‚Ù„")
    
    col_prev, col_next = st.columns(2)
    
    with col_prev:
        if lesson_id > 1:
            if st.button("â¬…ï¸ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ù‚"):
                st.switch_page("pages/1_Ø§Ù„Ø¯Ø±ÙˆØ³.py")
        else:
            st.write("Ù‡Ø°Ø§ Ø£ÙˆÙ„ Ø¯Ø±Ø³")
    
    with col_next:
        if lesson_id < len(lessons):
            if st.button("â¡ï¸ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ"):
                st.switch_page("pages/1_Ø§Ù„Ø¯Ø±ÙˆØ³.py")
        else:
            st.write("Ù‡Ø°Ø§ Ø¢Ø®Ø± Ø¯Ø±Ø³")
    
    # Additional resources
    st.subheader("ğŸ“š Ù…ÙˆØ§Ø±Ø¯ Ø¥Ø¶Ø§ÙÙŠØ©")
    st.write("Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù…Ù…Ø§Ø±Ø³Ø©:")
    st.write("â€¢ Ø¬Ø±Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù…Ø«Ù„Ø©")
    st.write("â€¢ Ø§ÙƒØªØ¨ Ø£ÙƒÙˆØ§Ø¯ Ù…Ø´Ø§Ø¨Ù‡Ø©")
    st.write("â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙÙ‡Ù… ÙƒÙ„ Ø³Ø·Ø±")
    st.write("â€¢ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø±Ø³")

# Footer
st.markdown("---")
col_foot1, col_foot2, col_foot3 = st.columns(3)

with col_foot1:
    if st.button("ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"):
        st.switch_page("app.py")

with col_foot2:
    if st.button("ğŸ® Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒÙˆØ¯"):
        st.switch_page("pages/2_Ù…Ù„Ø¹Ø¨_Ø§Ù„ÙƒÙˆØ¯.py")

with col_foot3:
    if st.button("ğŸ“Š Ø§Ù„ØªÙ‚Ø¯Ù…"):
        st.switch_page("pages/4_Ø§Ù„ØªÙ‚Ø¯Ù….py")
import streamlit as st
from streamlit_ace import st_ace
from utils.code_executor import CodeExecutor
from utils.progress_tracker import ProgressTracker
import time

# Page configuration
st.set_page_config(page_title="Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒÙˆØ¯", page_icon="ğŸ®", layout="wide")

# Initialize utilities
if 'code_executor' not in st.session_state:
    st.session_state.code_executor = CodeExecutor()

if 'progress_tracker' not in st.session_state:
    st.session_state.progress_tracker = ProgressTracker()

if 'code_history' not in st.session_state:
    st.session_state.code_history = []

st.title("ğŸ® Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒÙˆØ¯")
st.write("Ù…Ø³Ø§Ø­Ø© Ø­Ø±Ø© Ù„ØªØ¬Ø±Ø¨Ø© ÙˆÙƒØªØ§Ø¨Ø© Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø§ÙŠØ«ÙˆÙ†")

# Sidebar with examples and history
st.sidebar.title("ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©")

# Code templates
st.sidebar.subheader("ğŸ“ Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø§Ù‡Ø²Ø©")
templates = {
    "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…": "print('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…!')",
    "Ù…ØªØºÙŠØ±Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©": "name = 'Ø£Ø­Ù…Ø¯'\nage = 25\nprint(f'Ø§Ø³Ù…ÙŠ {name} ÙˆØ¹Ù…Ø±ÙŠ {age} Ø³Ù†Ø©')",
    "Ø­Ù„Ù‚Ø© for": "for i in range(1, 6):\n    print(f'Ø§Ù„Ø±Ù‚Ù…: {i}')",
    "Ø­Ù„Ù‚Ø© while": "count = 1\nwhile count <= 5:\n    print(count)\n    count += 1",
    "Ù‚Ø§Ø¦Ù…Ø©": "fruits = ['ØªÙØ§Ø­', 'Ù…ÙˆØ²', 'Ø¨Ø±ØªÙ‚Ø§Ù„']\nfor fruit in fruits:\n    print(fruit)",
    "Ø¯Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø©": "def greet(name):\n    return f'Ù…Ø±Ø­Ø¨Ø§Ù‹ {name}!'\n\nresult = greet('Ø³Ø§Ø±Ø©')\nprint(result)",
    "Ù‚Ø§Ù…ÙˆØ³": "student = {'name': 'Ø£Ø­Ù…Ø¯', 'age': 20, 'grade': 85}\nprint(f\"Ø§Ù„Ø·Ø§Ù„Ø¨: {student['name']}\")\nprint(f\"Ø§Ù„Ø¹Ù…Ø±: {student['age']}\")",
    "Ø¬Ù…Ù„Ø© Ø´Ø±Ø·ÙŠØ©": "number = 15\nif number > 10:\n    print('Ø§Ù„Ø¹Ø¯Ø¯ Ø£ÙƒØ¨Ø± Ù…Ù† 10')\nelse:\n    print('Ø§Ù„Ø¹Ø¯Ø¯ Ø£ØµØºØ± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ 10')"
}

selected_template = st.sidebar.selectbox(
    "Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨:",
    ["Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨..."] + list(templates.keys())
)

if selected_template != "Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨...":
    if st.sidebar.button("ğŸ“‹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨"):
        st.session_state.playground_code = templates[selected_template]
        st.rerun()

# Code history
st.sidebar.subheader("ğŸ“š ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£ÙƒÙˆØ§Ø¯")
if st.session_state.code_history:
    history_options = [f"ÙƒÙˆØ¯ {i+1}" for i in range(len(st.session_state.code_history))]
    selected_history = st.sidebar.selectbox("Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:", ["Ø§Ø®ØªØ± ÙƒÙˆØ¯..."] + history_options)
    
    if selected_history != "Ø§Ø®ØªØ± ÙƒÙˆØ¯...":
        history_index = history_options.index(selected_history)
        if st.sidebar.button("ğŸ“¥ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙƒÙˆØ¯"):
            st.session_state.playground_code = st.session_state.code_history[history_index]['code']
            st.rerun()
        
        # Preview of the selected code
        st.sidebar.code(st.session_state.code_history[history_index]['code'][:100] + "..." if len(st.session_state.code_history[history_index]['code']) > 100 else st.session_state.code_history[history_index]['code'])

else:
    st.sidebar.info("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯")

# Clear history
if st.session_state.code_history and st.sidebar.button("ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ØªØ§Ø±ÙŠØ®"):
    st.session_state.code_history = []
    st.rerun()

# Main content area
col1, col2 = st.columns([3, 1])

with col1:
    # Code editor
    st.subheader("ğŸ’» Ù…Ø­Ø±Ø± Ø§Ù„ÙƒÙˆØ¯")
    
    # Get initial code
    initial_code = st.session_state.get('playground_code', 
        "# Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒÙˆØ¯!\n# Ø§ÙƒØªØ¨ ÙƒÙˆØ¯Ùƒ Ù‡Ù†Ø§ ÙˆØ¬Ø±Ø¨Ù‡\n\nprint('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø¨Ø§ÙŠØ«ÙˆÙ†!')")
    
    user_code = st_ace(
        value=initial_code,
        language='python',
        theme='github',
        font_size=16,
        tab_size=4,
        wrap=True,
        height=400,
        key="playground_editor",
        auto_update=True
    )
    
    # Update session state
    st.session_state.playground_code = user_code
    
    # Control buttons
    col_run, col_save, col_clear, col_share = st.columns([2, 1, 1, 1])
    
    with col_run:
        if st.button("â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯", type="primary", use_container_width=True):
            if user_code.strip():
                # Validate code
                is_valid, validation_msg = st.session_state.code_executor.validate_code(user_code)
                
                if is_valid:
                    with st.spinner("Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯..."):
                        result = st.session_state.code_executor.execute_code(user_code)
                        st.session_state.progress_tracker.increment_code_runs()
                    
                    # Display results
                    if result['success']:
                        st.success("âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!")
                        
                        if result['output']:
                            st.subheader("ğŸ“¤ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª:")
                            st.code(result['output'], language='text')
                        else:
                            st.info("Ø§Ù„ÙƒÙˆØ¯ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡ Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙ„ÙƒÙ† Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø±Ø¬Ø§Øª Ù„Ù„Ø¹Ø±Ø¶")
                        
                        # Execution info
                        col_time, col_lines = st.columns(2)
                        with col_time:
                            st.metric("ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°", f"{result['execution_time']:.3f} Ø«Ø§Ù†ÙŠØ©")
                        with col_lines:
                            lines_count = len(user_code.split('\n'))
                            st.metric("Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø±", lines_count)
                    else:
                        st.error("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯:")
                        st.code(result['error'], language='text')
                        
                        # Helpful tips based on error
                        if "SyntaxError" in result['error']:
                            st.info("ğŸ’¡ Ù†ØµÙŠØ­Ø©: ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ ÙˆØ§Ù„ÙÙˆØ§ØµÙ„ ÙˆØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³")
                        elif "NameError" in result['error']:
                            st.info("ğŸ’¡ Ù†ØµÙŠØ­Ø©: ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¹Ø±ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§")
                        elif "IndentationError" in result['error']:
                            st.info("ğŸ’¡ Ù†ØµÙŠØ­Ø©: ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø·Ø±")
                else:
                    st.error(f"âŒ {validation_msg}")
            else:
                st.warning("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø¨Ø¹Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹")
    
    with col_save:
        if st.button("ğŸ’¾ Ø­ÙØ¸", use_container_width=True):
            if user_code.strip():
                # Save to history
                code_entry = {
                    'code': user_code,
                    'timestamp': time.time(),
                    'lines': len(user_code.split('\n'))
                }
                st.session_state.code_history.append(code_entry)
                # Keep only last 10 codes
                if len(st.session_state.code_history) > 10:
                    st.session_state.code_history = st.session_state.code_history[-10:]
                st.success("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯!")
            else:
                st.warning("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ù„Ù„Ø­ÙØ¸")
    
    with col_clear:
        if st.button("ğŸ—‘ï¸ Ù…Ø³Ø­", use_container_width=True):
            st.session_state.playground_code = "# Ø§ÙƒØªØ¨ ÙƒÙˆØ¯Ùƒ Ù‡Ù†Ø§\n\n"
            st.rerun()
    
    with col_share:
        if st.button("ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©", use_container_width=True):
            if user_code.strip():
                st.text_area(
                    "Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©:",
                    user_code,
                    height=100,
                    key="share_code"
                )
            else:
                st.warning("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©")

with col2:
    # Statistics and tips
    st.subheader("ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª")
    
    # User statistics
    stats = st.session_state.progress_tracker.get_progress_stats()
    st.metric("Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„", stats['total_code_runs'])
    st.metric("Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©", len(st.session_state.code_history))
    
    # Current code info
    if user_code:
        lines = len(user_code.split('\n'))
        chars = len(user_code)
        st.metric("Ø£Ø³Ø·Ø± Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ", lines)
        st.metric("Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù", chars)
    
    # Tips section
    st.subheader("ğŸ’¡ Ù†ØµØ§Ø¦Ø­")
    tips = [
        "Ø§Ø³ØªØ®Ø¯Ù… print() Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬",
        "ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©",
        "Ø§Ø®ØªØ¨Ø± Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø·Ø¹Ø© Ù‚Ø·Ø¹Ø©",
        "Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„ÙƒÙˆØ¯",
        "Ø¬Ø±Ø¨ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¹Ù„Ù…",
        "Ø§Ø­ÙØ¸ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ÙÙŠØ¯Ø© Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„ÙŠÙ‡Ø§"
    ]
    
    for tip in tips:
        st.write(f"â€¢ {tip}")
    
    # Quick references
    st.subheader("ğŸ“– Ù…Ø±Ø§Ø¬Ø¹ Ø³Ø±ÙŠØ¹Ø©")
    
    with st.expander("Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©"):
        st.code("""
# Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
print("Ù…Ø±Ø­Ø¨Ø§Ù‹")

# Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
name = "Ø£Ø­Ù…Ø¯"
age = 25

# Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©
result = 10 + 5
        """)
    
    with st.expander("Ø§Ù„Ø­Ù„Ù‚Ø§Øª"):
        st.code("""
# Ø­Ù„Ù‚Ø© for
for i in range(5):
    print(i)

# Ø­Ù„Ù‚Ø© while
count = 0
while count < 5:
    print(count)
    count += 1
        """)
    
    with st.expander("Ø§Ù„Ø´Ø±ÙˆØ·"):
        st.code("""
# Ø¬Ù…Ù„Ø© Ø´Ø±Ø·ÙŠØ©
if age >= 18:
    print("Ø¨Ø§Ù„Øº")
else:
    print("Ù‚Ø§ØµØ±")
        """)

# Footer navigation
st.markdown("---")
col_nav1, col_nav2, col_nav3 = st.columns(3)

with col_nav1:
    if st.button("ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"):
        st.switch_page("app.py")

with col_nav2:
    if st.button("ğŸ“š Ø§Ù„Ø¯Ø±ÙˆØ³"):
        st.switch_page("pages/1_Ø§Ù„Ø¯Ø±ÙˆØ³.py")

with col_nav3:
    if st.button("ğŸ’ª Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†"):
        st.switch_page("pages/3_Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†.py")
import sys
import io
import contextlib
import traceback
import time

class CodeExecutor:
    def __init__(self):
        self.max_execution_time = 5  # Maximum execution time in seconds
        
    def execute_code(self, code):
        """
        Execute Python code safely and return the output, errors, and execution time.
        """
        # Capture stdout and stderr
        stdout_capture = io.StringIO()
        stderr_capture = io.StringIO()
        
        # Store original stdout and stderr
        original_stdout = sys.stdout
        original_stderr = sys.stderr
        
        # Record start time
        start_time = time.time()
        
        try:
            # Redirect output
            sys.stdout = stdout_capture
            sys.stderr = stderr_capture
            
            # Create a restricted globals dictionary
            restricted_globals = {
                '__builtins__': {
                    'print': print,
                    'len': len,
                    'str': str,
                    'int': int,
                    'float': float,
                    'bool': bool,
                    'list': list,
                    'dict': dict,
                    'tuple': tuple,
                    'set': set,
                    'range': range,
                    'enumerate': enumerate,
                    'zip': zip,
                    'type': type,
                    'abs': abs,
                    'round': round,
                    'min': min,
                    'max': max,
                    'sum': sum,
                    'sorted': sorted,
                    'input': self._safe_input,
                    'isinstance': isinstance,
                    'ValueError': ValueError,
                    'TypeError': TypeError,
                    'IndexError': IndexError,
                    'KeyError': KeyError,
                }
            }
            
            # Execute the code
            exec(code, restricted_globals)
            
            # Calculate execution time
            execution_time = time.time() - start_time
            
            # Get output
            output = stdout_capture.getvalue()
            error = stderr_capture.getvalue()
            
            return {
                'success': True,
                'output': output,
                'error': error,
                'execution_time': execution_time
            }
            
        except Exception as e:
            # Calculate execution time even for errors
            execution_time = time.time() - start_time
            
            # Get the traceback
            error_traceback = traceback.format_exc()
            
            return {
                'success': False,
                'output': stdout_capture.getvalue(),
                'error': self._format_error(error_traceback),
                'execution_time': execution_time
            }
            
        finally:
            # Restore original stdout and stderr
            sys.stdout = original_stdout
            sys.stderr = original_stderr
    
    def _safe_input(self, prompt=""):
        """
        Safe input function that returns a predetermined value
        """
        return "test_input"
    
    def _format_error(self, error_traceback):
        """
        Format error messages to be more user-friendly in Arabic
        """
        if "SyntaxError" in error_traceback:
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙŠØºØ©: ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­"
        elif "NameError" in error_traceback:
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³Ù…: Ù…ØªØºÙŠØ± Ø£Ùˆ Ø¯Ø§Ù„Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙØ©"
        elif "TypeError" in error_traceback:
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†ÙˆØ¹: ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©"
        elif "IndexError" in error_traceback:
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙÙ‡Ø±Ø³: Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¹Ù†ØµØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
        elif "ValueError" in error_traceback:
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©: Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©"
        elif "IndentationError" in error_traceback:
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª: ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø·Ø±"
        else:
            # Return the last line of the traceback which usually contains the error
            lines = error_traceback.strip().split('\n')
            return lines[-1] if lines else "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"
    
    def validate_code(self, code):
        """
        Validate code before execution
        """
        # Check for potentially dangerous operations
        dangerous_keywords = ['import os', 'import sys', 'import subprocess', 
                             'exec(', 'eval(', '__import__', 'open(', 'file(']
        
        for keyword in dangerous_keywords:
            if keyword in code:
                return False, f"Ø§Ù„ÙƒÙˆØ¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­Ø©: {keyword}"
        
        # Check for infinite loops (basic check)
        if 'while True:' in code and 'break' not in code:
            return False, "Ø§Ø­Ø°Ø± Ù…Ù† Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠØ©! ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø´Ø±Ø· Ù„Ù„Ø®Ø±ÙˆØ¬"
        
        return True, "Ø§Ù„ÙƒÙˆØ¯ Ø¢Ù…Ù† Ù„Ù„ØªÙ†ÙÙŠØ°"
import streamlit as st
import json
import os

class ProgressTracker:
    def __init__(self):
        self.progress_file = "user_progress.json"
        self.load_progress()
    
    def load_progress(self):
        """Load user progress from session state or create new"""
        if 'user_progress' not in st.session_state:
            st.session_state.user_progress = {
                'completed_lessons': [],
                'completed_exercises': [],
                'quiz_scores': {},
                'total_code_runs': 0,
                'last_lesson': 1
            }
    
    def mark_lesson_completed(self, lesson_id):
        """Mark a lesson as completed"""
        if lesson_id not in st.session_state.user_progress['completed_lessons']:
            st.session_state.user_progress['completed_lessons'].append(lesson_id)
            st.session_state.user_progress['last_lesson'] = max(
                st.session_state.user_progress['last_lesson'], lesson_id + 1
            )
    
    def mark_exercise_completed(self, exercise_id):
        """Mark an exercise as completed"""
        if exercise_id not in st.session_state.user_progress['completed_exercises']:
            st.session_state.user_progress['completed_exercises'].append(exercise_id)
    
    def save_quiz_score(self, lesson_id, score):
        """Save quiz score for a lesson"""
        st.session_state.user_progress['quiz_scores'][str(lesson_id)] = score
    
    def increment_code_runs(self):
        """Increment the counter for code executions"""
        st.session_state.user_progress['total_code_runs'] += 1
    
    def get_completed_lessons_count(self):
        """Get number of completed lessons"""
        return len(st.session_state.user_progress['completed_lessons'])
    
    def get_completed_exercises_count(self):
        """Get number of completed exercises"""
        return len(st.session_state.user_progress['completed_exercises'])
    
    def get_overall_progress(self):
        """Calculate overall progress percentage"""
        total_lessons = 10  # Total number of lessons
        completed_lessons = self.get_completed_lessons_count()
        return (completed_lessons / total_lessons) * 100
    
    def is_lesson_completed(self, lesson_id):
        """Check if a lesson is completed"""
        return lesson_id in st.session_state.user_progress['completed_lessons']
    
    def is_exercise_completed(self, exercise_id):
        """Check if an exercise is completed"""
        return exercise_id in st.session_state.user_progress['completed_exercises']
    
    def get_quiz_score(self, lesson_id):
        """Get quiz score for a lesson"""
        return st.session_state.user_progress['quiz_scores'].get(str(lesson_id), 0)
    
    def get_next_lesson(self):
        """Get the next lesson to study"""
        return st.session_state.user_progress['last_lesson']
    
    def reset_progress(self):
        """Reset all progress"""
        st.session_state.user_progress = {
            'completed_lessons': [],
            'completed_exercises': [],
            'quiz_scores': {},
            'total_code_runs': 0,
            'last_lesson': 1
        }
    
    def get_progress_stats(self):
        """Get detailed progress statistics"""
        return {
            'completed_lessons': self.get_completed_lessons_count(),
            'completed_exercises': self.get_completed_exercises_count(),
            'total_code_runs': st.session_state.user_progress['total_code_runs'],
            'overall_progress': self.get_overall_progress(),
            'next_lesson': self.get_next_lesson(),
            'quiz_scores': st.session_state.user_progress['quiz_scores']
        }[server]
headless = true
address = "0.0.0.0"
port = 5000

[theme]
primaryColor = "#1f77b4"
backgroundColor = "#ffffff"
secondaryBackgroundColor = "#f0f2f6"
textColor = "#262730"
